/*! third party licenses: js/vendor.LICENSE.txt */
import{T as S}from"./TaskCreateDialog-D9vIR_Ml.mjs";import{_ as U,c as l,a as h,o as s,s as x,R as N,C as $,e as r,G as g,x as i,H as v,d as u,b as y,t as C,F as M,r as w,y as B,I as D,f as W,L as O,j as z,am as P,u as j,c4 as H,m as F,P as G,p as R,g as V,l as q,ab as X,S as o,a3 as J,bX as K,ap as Q,a5 as Y,W as Z,bR as tt,n as et,c2 as at,c3 as st}from"./store-DE2z1cMA.mjs";import{G as A,b as nt,P as ot}from"./Plus--OvEy1Tw.mjs";const rt={data(){return{color:"currentColor"}}},it={role:"img",class:"task-icon"},lt=["width","height"],dt=["fill","stroke"];function ct(t,n,e,d,c,a){return s(),l("span",it,[(s(),l("svg",{width:t.size,height:t.size,viewBox:"0 0 32 32"},[h("path",{fill:c.color,stroke:c.color,"stroke-miterlimit":"10","stroke-width":".75",d:"m14.383 26.764s0.259-0.716 0.563-1.367c4.908-10.57 11.212-17.53 14.008-20.69 2.264-2.559 1.378-2.156 0.375-1.503-4.09 2.659-11.742 11.206-14.668 14.169-0.542 0.545-1.769 1.833-2.045 1.833-0.313 0-1.358-0.481-1.955-0.833-2.282-1.338-4.464-2.643-5.834-3.136-2.917-1.049-2.092-0.052-1.926 0.281 0.521 1.042 7.566 6.689 9.899 9.356 0.722 0.824 1.583 1.89 1.583 1.89z"},null,8,dt)],8,lt))])}const mt=U(rt,[["render",ct],["__scopeId","data-v-b78bc47d"]]),ut={name:"NcDashboardWidgetItem",components:{NcAvatar:N,NcActions:$,NcActionButton:A},props:{id:{type:[String,Number],default:void 0},targetUrl:{type:String,default:void 0},avatarUrl:{type:String,default:void 0},avatarUsername:{type:String,default:void 0},avatarIsNoUser:{type:Boolean,default:!1},overlayIconUrl:{type:String,default:void 0},mainText:{type:String,required:!0},subText:{type:String,default:""},itemMenu:{type:Object,default:()=>({})},forceMenu:{type:Boolean,default:!0}},data(){return{hovered:!1}},computed:{item(){return{id:this.id,targetUrl:this.targetUrl,avatarUrl:this.avatarUrl,avatarUsername:this.avatarUsername,overlayIconUrl:this.overlayIconUrl,mainText:this.mainText,subText:this.subText}},gotMenu(){return Object.keys(this.itemMenu).length!==0||!!this.$slots.actions},gotOverlayIcon(){return this.overlayIconUrl&&this.overlayIconUrl!==""}},methods:{onLinkClick(t){t.target.closest(".action-item")&&t.preventDefault()}}},ht=["src"],kt={class:"item__details"},pt=["title"],yt=["title"];function gt(t,n,e,d,c,a){const T=r("NcAvatar"),f=r("NcActionButton"),b=r("NcActions");return s(),l("div",{onMouseover:n[0]||(n[0]=p=>c.hovered=!0),onMouseleave:n[1]||(n[1]=p=>c.hovered=!1)},[(s(),g(O(e.targetUrl?"a":"div"),{href:e.targetUrl||void 0,target:e.targetUrl?"_blank":void 0,class:W({"item-list__entry":!0,"item-list__entry--has-actions-menu":a.gotMenu}),onClick:a.onLinkClick},{default:i(()=>[v(t.$slots,"avatar",{avatarUrl:e.avatarUrl,avatarUsername:e.avatarUsername},()=>[u(T,{class:"item-avatar",size:44,url:e.avatarUrl,user:e.avatarUsername,"is-no-user":e.avatarIsNoUser,"show-user-status":!a.gotOverlayIcon},null,8,["url","user","is-no-user","show-user-status"])],!0),e.overlayIconUrl?(s(),l("img",{key:0,class:"item-icon",alt:"",src:e.overlayIconUrl},null,8,ht)):y("",!0),h("div",kt,[h("h3",{title:e.mainText},C(e.mainText),9,pt),h("span",{class:"message",title:e.subText},C(e.subText),9,yt)]),a.gotMenu?(s(),g(b,{key:1,"force-menu":e.forceMenu},{default:i(()=>[v(t.$slots,"actions",{},()=>[(s(!0),l(M,null,w(e.itemMenu,(p,m)=>(s(),g(f,{key:m,icon:p.icon,"close-after-click":!0,onClick:B(I=>t.$emit(m,a.item),["prevent","stop"])},{default:i(()=>[D(C(p.text),1)]),_:2},1032,["icon","onClick"]))),128))],!0)]),_:3},8,["force-menu"])):y("",!0)]),_:3},8,["href","target","class","onClick"]))],32)}const _=x(ut,[["render",gt],["__scopeId","data-v-00e861ef"]]);z(H);const ft={name:"NcDashboardWidget",components:{NcAvatar:N,NcDashboardWidgetItem:_,NcEmptyContent:P,Check:nt},props:{items:{type:Array,default:()=>[]},showMoreUrl:{type:String,default:""},showMoreLabel:{type:String,default:j("More items …")},loading:{type:Boolean,default:!1},itemMenu:{type:Object,default:()=>({})},showItemsAndEmptyContent:{type:Boolean,default:!1},emptyContentMessage:{type:String,default:""},halfEmptyContentMessage:{type:String,default:""}},computed:{handlers(){const t={};for(const n in this.itemMenu)t[n]=e=>{this.$emit(n,e)};return t},displayedItems(){const t=this.showMoreUrl&&this.items.length>=this.maxItemNumber?this.maxItemNumber-1:this.maxItemNumber;return this.items.slice(0,t)},showHalfEmptyContentArea(){return this.showItemsAndEmptyContent&&this.halfEmptyContentString&&this.items.length!==0},halfEmptyContentString(){return this.halfEmptyContentMessage||this.emptyContentMessage},maxItemNumber(){return this.showItemsAndEmptyContent?5:7},showMore(){return this.showMoreUrl&&this.items.length>=this.maxItemNumber}}},vt=t=>(R("data-v-b0ac6ae2"),t=t(),V(),t),Ct={class:"dashboard-widget"},Tt={key:1},bt=vt(()=>h("div",{class:"item__details"},[h("h3",null," "),h("p",{class:"message"},"   ")],-1)),Mt=["href"];function wt(t,n,e,d,c,a){const T=r("Check"),f=r("NcEmptyContent"),b=r("NcDashboardWidgetItem"),p=r("NcAvatar");return s(),l("div",Ct,[a.showHalfEmptyContentArea?(s(),g(f,{key:0,description:a.halfEmptyContentString,class:"half-screen"},{icon:i(()=>[v(t.$slots,"halfEmptyContentIcon",{},()=>[u(T)],!0)]),_:3},8,["description"])):y("",!0),h("ul",null,[(s(!0),l(M,null,w(a.displayedItems,m=>(s(),l("li",{key:m.id},[v(t.$slots,"default",{item:m},()=>[u(b,F(m,{"item-menu":e.itemMenu},G(a.handlers)),null,16,["item-menu"])],!0)]))),128))]),e.loading?(s(),l("div",Tt,[(s(),l(M,null,w(7,m=>h("div",{key:m,class:"item-list__entry"},[u(p,{class:"item-avatar",size:44}),bt])),64))])):e.items.length===0?v(t.$slots,"empty-content",{key:2},()=>[e.emptyContentMessage?(s(),g(f,{key:0,description:e.emptyContentMessage},{icon:i(()=>[v(t.$slots,"emptyContentIcon",{},void 0,!0)]),_:3},8,["description"])):y("",!0)],!0):a.showMore?(s(),l("a",{key:3,href:e.showMoreUrl,target:"_blank",class:"more",tabindex:"0"},C(e.showMoreLabel),9,Mt)):y("",!0)])}const Dt=x(ft,[["render",wt],["__scopeId","data-v-b0ac6ae2"]]),It={name:"Dashboard",components:{NcActionButton:A,NcButton:q,Check:X,NcDashboardWidget:Dt,NcDashboardWidgetItem:_,TaskCreateDialog:S,Plus:ot,TaskIcon:mt},data(){return{loading:!0,tasks:[],showAddTaskModal:!1,itemMenu:{markAsDone:{text:o("tasks","Mark as done"),icon:"icon-checkmark"}}}},computed:{...J({calendars:"getTaskCalendars"}),hasTaskToday(){return this.filteredTasks.some(t=>K(t,"today"))},filteredTasks(){return Q(this.tasks.filter(t=>!t.closed))}},mounted(){this.initializeEnvironment()},methods:{t:o,...Y(["toggleCompleted"]),async initializeEnvironment(){var e;await Z.connect({enableCalDAV:!0}),await this.$store.dispatch("fetchCurrentUserPrincipal");let{calendars:t}=await this.$store.dispatch("getCalendarsAndTrashBin");t=t.filter(d=>d.supportsTasks);const n=[];if(t.forEach(d=>{n.indexOf(d.owner)===-1&&n.push(d.owner)}),n.forEach(d=>{this.$store.dispatch("fetchPrincipalByUrl",{url:d})}),t.length===0){const d=((e=this.$OCA.Theming)==null?void 0:e.color)||"#0082C9";await this.$store.dispatch("appendCalendar",{displayName:o("tasks","Tasks"),color:d})}await this.fetchTasks()},async fetchTasks(){this.loading=!0;const t=await Promise.all(this.calendars.map(n=>this.$store.dispatch("getTasksFromCalendar",{calendar:n,completed:!1,related:null})));this.tasks=[...t.flat()],this.loading=!1},formatSubtext(t){return t.dueMoment.isValid()?t.allDay?t.dueMoment.calendar(null,{lastDay:o("tasks","[Due yesterday]"),sameDay:o("tasks","[Due today]"),nextDay:o("tasks","[Due tomorrow]"),lastWeek:o("tasks","[Due] L"),nextWeek:o("tasks","[Due] L"),sameElse:o("tasks","[Due] L")}):t.dueMoment.calendar(null,{lastDay:o("tasks","[Due yesterday at] LT"),sameDay:o("tasks","[Due today at] LT"),nextDay:o("tasks","[Due tomorrow at] LT"),lastWeek:o("tasks","[Due] L [at] LT"),nextWeek:o("tasks","[Due] L [at] LT"),sameElse:o("tasks","[Due] L [at] LT")}):o("tasks","No due date assigned")},getTasksAppUrl(t){return tt("apps/tasks")+"/#/calendars/".concat(t.calendar.id,"/tasks/").concat(t.uri)},toggleAddTaskModel(){this.showAddTaskModal=!this.showAddTaskModal},async onMarkAsDone(t){await this.toggleCompleted(t),await this.fetchTasks()}}},Ut=["title"],xt={key:0,class:"center-button"};function Nt(t,n,e,d,c,a){const T=r("Check"),f=r("NcActionButton"),b=r("NcDashboardWidgetItem"),p=r("TaskIcon"),m=r("NcDashboardWidget"),I=r("Plus"),L=r("NcButton"),E=r("TaskCreateDialog");return s(),l("div",null,[u(m,{id:"tasks_panel",items:a.filteredTasks.slice(0,a.hasTaskToday?6:4),"empty-content-message":a.t("tasks","No upcoming tasks"),"show-more-text":a.t("tasks","upcoming tasks"),loading:c.loading,"show-items-and-empty-content":!a.hasTaskToday,"half-empty-content-message":a.t("tasks","No tasks today")},{default:i(({item:k})=>[u(b,{"main-text":k.summary,"sub-text":a.formatSubtext(k),"target-url":a.getTasksAppUrl(k)},{avatar:i(()=>[h("div",{class:"calendar-dot",style:et({"background-color":k.calendar.color}),title:k.calendar.displayName},null,12,Ut)]),actions:i(()=>[!k.calendar.readOnly&&!(k.calendar.isSharedWithMe&&k.class!=="PUBLIC")?(s(),g(f,{key:0,"close-after-click":!0,onClick:_t=>a.onMarkAsDone(k)},{icon:i(()=>[u(T,{size:20,decorative:""})]),default:i(()=>[D(" "+C(a.t("tasks","Mark as done")),1)]),_:2},1032,["onClick"])):y("",!0)]),_:2},1032,["main-text","sub-text","target-url"])]),emptyContentIcon:i(()=>[u(p)]),_:1},8,["items","empty-content-message","show-more-text","loading","show-items-and-empty-content","half-empty-content-message"]),c.loading?y("",!0):(s(),l("div",xt,[u(L,{onClick:a.toggleAddTaskModel},{icon:i(()=>[u(I,{size:20,decorative:""})]),default:i(()=>[D(" "+C(a.t("tasks","Create a new task")),1)]),_:1},8,["onClick"]),c.showAddTaskModal?(s(),g(E,{key:0,onClose:a.toggleAddTaskModel},null,8,["onClose"])):y("",!0)]))])}const At=U(It,[["render",Nt]]);document.addEventListener("DOMContentLoaded",()=>{OCA.Dashboard.register("tasks",t=>at(At).use(st).mount(t))});
